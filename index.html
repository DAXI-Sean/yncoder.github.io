---
layout: page
type: list
---

<div class="container">
	<aside>
		<a href="https://github.com/yncoder/yncoder.github.io/issues/new" target="_blank" class="btn-add"><span>+</span>发布新消息</a>
	</aside>
	<main>
		<ul id="label-list"></ul>
		<ul id="issue-list"></ul>
	</main>
</div>

<script>
(function () {
	function ajax (url, options, callback) {
		options = options || {};

		var query = Object.keys(options.query || {}).map(function (key) {
			return key + '=' + encodeURIComponent(options.query[key]);
		}).join('&');

		var request = new XMLHttpRequest();
		request.responseType = options.responseType || 'json';
		request.open(options.method || 'GET', url + (query ? '?' + query : ''), true);

		request.onreadystatechange = function () {
			if (this.readyState != 4) {
				return;
			}

			if (this.status >= 200 && this.status < 300) {
				callback(this.response);
			} else if(this.status == 403) {
				document.queryAllSelector('.page-list .container main').innerHTML = "<h1 class='alert-error'>别刷了，快去干活</h1>";
			}
		};

		request.send(options.data || null);
	}

	function escapeHTML (str) {
		return str.replace(/([&<>'"])/g, function (matcher, symbol) {
			return '&#' + symbol.charCodeAt(0) + ';';
		});
	}

	function format (template, data) {
		return template.replace(/\{(\s*\w+\s*)\}/g, function (matcher, name) {
			var value = data[name.trim()];
			return typeof value != 'undefined' ? value : '';
		});
	}

	ajax('//api.github.com/repos/yncoder/yncoder.github.io/issues', {
		query: {
			state: 'open'
		}
	}, function (data) {
		var template = '<li class="{labelClasses} {statusClass}">' +
			'<figure><img src="{authorAvatarUrl}" /></figure>' +
			'<div class="title"><h4><a href="{link}">{title}</h4>' +
			'<p>{labelElements} <a class="author" href="{authorLink}" target="_blank">{authorName}</a><i>{comments} 条评论</i></p></div>';

		var labelTemplate = '<a href="{url}" class="label" style="backbround-color: #{color}">{name}</a>';

		function renderLabelItem (label) {
			return format(labelTemplate, label);
		}

		function renderLabelClass (label) {
			return 'label-' + label.name;
		}

		var html = data.map(function (item) {
			return format(template, {
				labelClasses: item.labels.map(renderLabelClass).join(''),
				labelElements: item.labels.map(renderLabelItem).join(''),
				title: escapeHTML(item.title),
				link: item.html_url,
				authorAvatarUrl: item.user.avatar_url,
				authorName: item.user.login,
				authorLink: item.user.html_url,
				comments: item.comments
			});
		}).join('');

		document.getElementById('issue-list').innerHTML = html;
	});

	// ajax('//api.github.com/repos/yncoder/yncoder.github.io/labels', null, function (data) {

	// });
})();
</script>
